<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Bites Payment</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
<h1>Quick Bites Payment</h1>
<button id="pay-button">Pay Now</button>

<script>
    document.getElementById('pay-button').addEventListener('click', function() {
        fetch('/api/payment/create-order', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                amount: 500, // Amount in INR
                receipt: "txn_123456" // Dynamic receipt ID
            })
        })
        .then(response => response.json())
        .then(data => {
            var options = {
                key: /*[[${razorpayKeyId}]]*/, // Razorpay key provided from the backend
                amount: data.amount, // Amount in paise
                currency: "INR",
                name: "Quick Bites",
                description: "Order Payment",
                order_id: data.orderId, // Order ID from backend
                handler: function (response) {
                    fetch('/api/payment/verify-payment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            orderId: response.razorpay_order_id,
                            paymentId: response.razorpay_payment_id,
                            signature: response.razorpay_signature,
                        })
                    })
                    .then(verificationResponse => verificationResponse.json())
                    .then(result => {
                        if (result.success) {
                            alert("Payment verified successfully!");
                        } else {
                            alert("Payment verification failed.");
                        }
                    });
                },
                prefill: {
                    name: "Customer Name",
                    email: "sachinsonarsk@gmail.com",
                    contact: "9892077388"
                },
                theme: {
                    color: "#F37254"
                }
            };

            var rzp = new Razorpay(options);
            rzp.open();
        });
    });
</script>
</body>
</html>
